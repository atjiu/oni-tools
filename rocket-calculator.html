<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>火箭燃料计算器</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: white;
            --bg-tertiary: #f8f9fa;
            --bg-card: white;
            --text-primary: #2c3e50;
            --text-secondary: #34495e;
            --text-muted: #7f8c8d;
            --text-light: #95a5a6;
            --border-color: #e1e8ed;
            --border-light: #ecf0f1;
            --accent-primary: #3498db;
            --accent-secondary: #e74c3c;
            --accent-success: #27ae60;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2d2d2d;
            --bg-card: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --text-muted: #b0b0b0;
            --text-light: #888888;
            --border-color: #404040;
            --border-light: #505050;
            --accent-primary: #4a9fea;
            --accent-secondary: #ff6b6b;
            --accent-success: #2ecc71;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .calculator-container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 15px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
        }

        .section {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid var(--accent-primary);
            transition: all 0.3s ease;
        }

        .section-title {
            font-size: 1.4em;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .section-title::before {
            content: "▶";
            color: var(--accent-primary);
            font-size: 0.8em;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            flex-direction: column;
            align-items: flex-start;
        }

        input[type="number"] {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 120px;
            background: var(--bg-card);
            color: var(--text-primary);
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        select {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .checkbox-group {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 15px;
            background: var(--bg-card);
            border-radius: 8px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
        }

        .results-section {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .results-title {
            font-size: 1.3em;
            color: var(--accent-success);
            margin-bottom: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .material-group {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-secondary);
            transition: all 0.3s ease;
        }

        .group-title {
            font-size: 1.2em;
            color: var(--text-primary);
            margin-bottom: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .ingredient-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .ingredient-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-light);
            border-color: var(--accent-primary);
        }

        .ingredient-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .ingredient-details {
            color: var(--text-muted);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .ingredient-path {
            font-size: 0.85em;
            color: var(--text-light);
            font-style: italic;
            border-top: 1px dashed var(--border-light);
            padding-top: 8px;
            transition: all 0.3s ease;
        }

        .no-results {
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
            padding: 40px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        /* 添加radio组样式 */
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .radio-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .radio-item:has(input:checked) {
            background: rgba(52, 152, 219, 0.1);
            border-color: var(--accent-primary);
        }

        .radio-item input[type="radio"] {
            display: none;
        }

        .radio-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .module-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 15px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .module-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
            border-color: var(--accent-primary);
        }

        .module-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .module-input {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .module-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }

        .module-input:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        .result-display {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-title {
            font-size: 1.2em;
            color: var(--accent-success);
            margin-bottom: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .result-content {
            color: var(--text-secondary);
            font-size: 1.1em;
            line-height: 1.5;
            transition: all 0.3s ease;
        }

        /* 添加贴图相关的样式 */
        .icon-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }

        .icon-img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .icon-text {
            flex: 1;
        }

        select option {
            padding: 8px 12px;
        }

        .ingredient-with-icon {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .ingredient-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .ingredient-text {
            flex: 1;
        }

        .path-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin: 0 2px;
        }

        .path-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
            border-radius: 2px;
        }

        /* 火箭引擎贴图样式 */
        .engine-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .module-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .fuel-icon {
            width: 20px;
            height: 20px;
            object-fit: contain;
            border-radius: 2px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .checkbox-group {
                flex-direction: column;
                gap: 10px;
            }

            .ingredients-grid {
                grid-template-columns: 1fr;
            }

            input[type="number"], select {
                width: 100%;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
            }

            .radio-group {
                gap: 10px;
            }

            .radio-item {
                padding: 8px 12px;
                font-size: 0.9em;
            }

            .module-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
            border-color: var(--accent-primary);
        }

        .result-item-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--bg-card);
            border-radius: 6px;
            padding: 4px;
        }

        .result-item-text {
            flex: 1;
        }

        .result-item-label {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .result-item-value {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
        }

        .result-success {
            color: var(--accent-success);
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .result-error {
            color: var(--accent-secondary);
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .result-tip {
            font-size: 0.9em;
            color: var(--text-muted);
            font-style: italic;
            border-top: 1px dashed var(--border-light);
            padding-top: 10px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .result-items {
                grid-template-columns: 1fr;
            }

            .result-item {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const 贴图 = {
        "蒸汽引擎": "https://oxygennotincluded.wiki.gg/zh/images/thumb/c/cb/%E8%92%B8%E6%B1%BD%E5%BC%95%E6%93%8E.png/100px-%E8%92%B8%E6%B1%BD%E5%BC%95%E6%93%8E.png?a9a5d0",
        "石油引擎": "https://oxygennotincluded.wiki.gg/zh/images/thumb/3/30/%E7%9F%B3%E6%B2%B9%E5%BC%95%E6%93%8E.png/100px-%E7%9F%B3%E6%B2%B9%E5%BC%95%E6%93%8E.png?615957",
        "液氢引擎": "https://oxygennotincluded.wiki.gg/zh/images/thumb/f/f9/%E6%B6%B2%E6%B0%A2%E5%BC%95%E6%93%8E.png/100px-%E6%B6%B2%E6%B0%A2%E5%BC%95%E6%93%8E.png?785bd7",
        "指挥舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/a/a9/%E6%8C%87%E6%8C%A5%E8%88%B1.png/100px-%E6%8C%87%E6%8C%A5%E8%88%B1.png?30f765",
        "研究舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/3/37/%E7%A0%94%E7%A9%B6%E8%88%B1.png/100px-%E7%A0%94%E7%A9%B6%E8%88%B1.png?5a6408",
        "货舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/0/0c/%E8%B4%A7%E8%88%B1.png/100px-%E8%B4%A7%E8%88%B1.png?af7cf6",
        "液缸货舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/e/ee/%E6%B6%B2%E7%BC%B8%E8%B4%A7%E8%88%B1.png/100px-%E6%B6%B2%E7%BC%B8%E8%B4%A7%E8%88%B1.png?9ae456",
        "观光舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/8/8c/%E8%A7%82%E5%85%89%E8%88%B1.png/100px-%E8%A7%82%E5%85%89%E8%88%B1.png?f5481b",
        "固体燃料推进器": "https://oxygennotincluded.wiki.gg/zh/images/thumb/f/f1/%E5%9B%BA%E4%BD%93%E7%87%83%E6%96%99%E6%8E%A8%E8%BF%9B%E5%99%A8.png/100px-%E5%9B%BA%E4%BD%93%E7%87%83%E6%96%99%E6%8E%A8%E8%BF%9B%E5%99%A8.png?dd8089",
        "生物货舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/c/c6/%E7%94%9F%E7%89%A9%E8%B4%A7%E8%88%B1.png/100px-%E7%94%9F%E7%89%A9%E8%B4%A7%E8%88%B1.png?3100ea",
        "气罐货舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/8/8c/%E6%B0%94%E7%BD%90%E8%B4%A7%E8%88%B1.png/100px-%E6%B0%94%E7%BD%90%E8%B4%A7%E8%88%B1.png?86cfd4",
        "固体氧化剂舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/c/cb/%E5%9B%BA%E4%BD%93%E6%B0%A7%E5%8C%96%E5%89%82%E8%88%B1.png/100px-%E5%9B%BA%E4%BD%93%E6%B0%A7%E5%8C%96%E5%89%82%E8%88%B1.png?5f4cdf",
        "液体氧化剂舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/b/b2/%E6%B6%B2%E4%BD%93%E6%B0%A7%E5%8C%96%E5%89%82%E8%88%B1.png/100px-%E6%B6%B2%E4%BD%93%E6%B0%A7%E5%8C%96%E5%89%82%E8%88%B1.png?63f367",
        "液缸燃料舱": "https://oxygennotincluded.wiki.gg/zh/images/thumb/f/fc/%E6%B6%B2%E7%BC%B8%E7%87%83%E6%96%99%E8%88%B1.png/100px-%E6%B6%B2%E7%BC%B8%E7%87%83%E6%96%99%E8%88%B1.png?eb3d51",
        "蒸汽": "https://oxygennotincluded.wiki.gg/zh/images/b/b4/%E8%92%B8%E6%B1%BD.png?bd3ce0",
        "石油": "https://oxygennotincluded.wiki.gg/zh/images/b/b1/%E7%9F%B3%E6%B2%B9.png?5d6f84",
        "液氢": "https://oxygennotincluded.wiki.gg/zh/images/f/f4/%E6%B6%B2%E6%80%81%E6%B0%A2.png?2a860f",
        "液氧": "https://oxygennotincluded.wiki.gg/zh/images/%E6%B6%B2%E6%80%81%E6%B0%A7.png?f5eba2",
        "氧石": "https://oxygennotincluded.wiki.gg/zh/images/c/ca/%E6%B0%A7%E7%9F%B3.png?636565",
    };

    //质量减益（千米） = max(质量, (质量/300)^3.2)（质量取千克值）
    //基础飞行距离（含氧化剂加成）- 质量减益 + 固体燃料推进器数量 × 12000
    function RocketCalculator() {
        const 燃料_蒸汽 = 20;
        const 燃料_石油 = 40;
        const 燃料_液氢 = 60;

        const 氧化剂_氧石 = 1;
        const 氧化剂_液氧 = 1.33;

        const 蒸汽引擎_质量 = 2000; const 蒸汽引擎_容量 = 900;
        const 石油引擎_质量 = 200;
        const 液氢引擎_质量 = 500;

        const 舱体_指挥舱_质量 = 200;
        const 舱体_研究舱_质量 = 200;
        const 舱体_货舱_质量 = 2000;
        const 舱体_液缸货舱_质量 = 1000;
        const 舱体_观光舱_质量 = 200;
        const 舱体_固体燃料推进器_质量 = 1000;
        const 舱体_生物货舱_质量 = 1000;
        const 舱体_气罐货舱_质量 = 1000;
        const 舱体_固体氧化剂舱_质量 = 100; const 舱体_固体氧化剂舱_容量 = 2700;
        const 舱体_液体氧化剂舱_质量 = 100; const 舱体_液体氧化剂舱_容量 = 2700;
        const 舱体_液缸燃料舱_质量 = 100; const 舱体_液缸燃料舱_容量 = 900;

        const [engine, setEngine] = React.useState("蒸汽引擎");
        const [oxidizer, setOxidizer] = React.useState("氧石");
        const [distance, setDistance] = React.useState(10000);
        const [solidFuelThruster, setSolidFuelThruster] = React.useState(0);
        const [researchModule, setResearchModule] = React.useState(0);
        const [sightSeeingModule, setSightSeeingModule] = React.useState(0);
        const [commandCapsule, setCommandCapsule] = React.useState(1);
        const [liquidOxidizerTank, setLiquidOxidizerTank] = React.useState(0);
        const [liquidFuelTank, setLiquidFuelTank] = React.useState(0);
        const [solidOxidizerTank, setSolidOxidizerTank] = React.useState(0);
        const [gasCargoCanister, setGasCargoCanister] = React.useState(0);
        const [cargoBay, setCargoBay] = React.useState(0);
        const [liquidCargoBay, setLiquidCargoBay] = React.useState(0);
        const [liquidCargoTank, setLiquidCargoTank] = React.useState(0);
        const [biologicalCargoBay, setBiologicalCargoBay] = React.useState(0);

        const [calculationResult, setCalculationResult] = React.useState(null);
        const [isDarkTheme, setIsDarkTheme] = React.useState(false);

        React.useEffect(() => {
            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            setIsDarkTheme(mediaQuery.matches);

            const handleChange = (e) => {
                setIsDarkTheme(e.matches);
            };

            mediaQuery.addEventListener('change', handleChange);
            return () => mediaQuery.removeEventListener('change', handleChange);
        }, []);

        React.useEffect(() => {
            document.documentElement.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
        }, [isDarkTheme]);

        const toggleTheme = () => {
            setIsDarkTheme(!isDarkTheme);
        };

        function calculateFuel() {
            let baseMass = 0;

            if (engine === "蒸汽引擎") {
                baseMass += 蒸汽引擎_质量;
            } else if (engine === "石油引擎") {
                baseMass += 石油引擎_质量;
            } else if (engine === "液氢引擎") {
                baseMass += 液氢引擎_质量;
            }

            baseMass += commandCapsule * 舱体_指挥舱_质量;
            baseMass += researchModule * 舱体_研究舱_质量;
            baseMass += cargoBay * 舱体_货舱_质量;
            baseMass += liquidCargoBay * 舱体_液缸货舱_质量;
            baseMass += sightSeeingModule * 舱体_观光舱_质量;
            baseMass += biologicalCargoBay * 舱体_生物货舱_质量;
            baseMass += gasCargoCanister * 舱体_气罐货舱_质量;

            const calculateDistance = (fuelAmount, fuelTanks, oxidizerTanks, thrusters = 0) => {
                let totalMass = baseMass;

                if (engine === "蒸汽引擎") {
                    totalMass += fuelAmount + thrusters * 舱体_固体燃料推进器_质量;
                    const baseFlightDistance = 燃料_蒸汽 * fuelAmount;
                    const massPenalty = Math.max(totalMass, Math.pow(totalMass / 300, 3.2));
                    return baseFlightDistance - massPenalty + thrusters * 12000;
                } else {
                    totalMass += fuelTanks * 舱体_液缸燃料舱_质量 +
                                oxidizerTanks * 舱体_液体氧化剂舱_质量 +
                                fuelAmount * 2;

                    let fuelType = 0;
                    let oxidizerMultiplier = 1;

                    if (engine === "石油引擎") fuelType = 燃料_石油;
                    if (engine === "液氢引擎") fuelType = 燃料_液氢;

                    if (oxidizer === "液氧") oxidizerMultiplier = 氧化剂_液氧;

                    const baseFlightDistance = fuelType * fuelAmount * oxidizerMultiplier;

                    const massRatio = totalMass / 300;
                    const massPenaltyValue = Math.pow(massRatio, 3.2);
                    const massPenalty = Math.max(totalMass, massPenaltyValue);

                    return baseFlightDistance - massPenalty;
                }
            };

            const findMinFuel = (maxFuel, fuelTanks = 0, oxidizerTanks = 0, thrusters = 0) => {
                let left = 1;
                let right = maxFuel;
                let minValidFuel = null;

                while (left <= right) {
                    const mid = Math.floor((left + right) / 2);
                    const actualDistance = calculateDistance(mid, fuelTanks, oxidizerTanks, thrusters);

                    if (actualDistance >= distance) {
                        minValidFuel = mid;
                        right = mid - 1;
                    } else {
                        left = mid + 1;
                    }
                }

                return minValidFuel;
            };

            if (engine === "蒸汽引擎") {
                const findSteamSolution = (thrusters, maxThrusters = 10) => {
                    if (thrusters > maxThrusters) return null;

                    const minFuel = findMinFuel(蒸汽引擎_容量, 0, 0, thrusters);

                    if (minFuel !== null) {
                        return { fuel: minFuel, thrusters };
                    }

                    return findSteamSolution(thrusters + 1, maxThrusters);
                };

                const solution = findSteamSolution(0);

                if (!solution) {
                    setCalculationResult({error: true});
                    setSolidFuelThruster(0);
                    return;
                }

                setSolidFuelThruster(solution.thrusters);
                setCalculationResult({
                    error: false,
                    fuelIcon: 贴图["蒸汽"],
                    fuelType: "蒸汽",
                    solution: solution,
                });
            } else {
                const fuelTankCapacity = 舱体_液缸燃料舱_容量;
                const oxidizerTankCapacity = 舱体_液体氧化剂舱_容量;

                const findLiquidSolution = (oxidizerTanks, maxOxidizerTanks = 6) => {
                    if (oxidizerTanks > maxOxidizerTanks) return null;

                    const maxFuelTanks = oxidizerTanks * 3;

                    for (let fuelTanks = 1; fuelTanks <= maxFuelTanks; fuelTanks++) {
                        const totalTanks = fuelTanks + oxidizerTanks;
                        if (totalTanks > 20) continue;

                        const maxFuel = fuelTanks * fuelTankCapacity;
                        const maxOxidizer = oxidizerTanks * oxidizerTankCapacity;
                        const actualMaxFuel = Math.min(maxFuel, maxOxidizer);

                        const fullDistance = calculateDistance(actualMaxFuel, fuelTanks, oxidizerTanks);
                        if (fullDistance >= distance) {
                            const minFuel = findMinFuel(actualMaxFuel, fuelTanks, oxidizerTanks);

                            if (minFuel !== null) {
                                return {
                                    fuelTanks,
                                    oxidizerTanks,
                                    fuelAmount: minFuel,
                                    totalTanks
                                };
                            }
                        }
                    }

                    return findLiquidSolution(oxidizerTanks + 1, maxOxidizerTanks);
                };

                const solution = findLiquidSolution(1);

                if (!solution) {
                    setCalculationResult({error: true});
                    setLiquidFuelTank(0);
                    setLiquidOxidizerTank(0);
                    return;
                }

                setLiquidFuelTank(solution.fuelTanks);
                setLiquidOxidizerTank(solution.oxidizerTanks);

                const fuelType = engine === "石油引擎" ? "石油" : "液氢";
                const fuelIcon = engine === "石油引擎" ? 贴图["石油"] : 贴图["液氢"];
                const oxidizerIcon = oxidizer === "液氧" ? 贴图["液氧"] : 贴图["氧石"];

                setCalculationResult({
                    error: false,
                    fuelIcon: fuelIcon,
                    fuelType: fuelType,
                    solution: solution,
                    oxidizerIcon: oxidizerIcon,
                    oxidizer: oxidizer,
                });
            }
        }

        React.useEffect(() => {
            calculateFuel();
        }, [engine, oxidizer, distance, researchModule, sightSeeingModule, commandCapsule,
            gasCargoCanister, cargoBay, liquidCargoBay, biologicalCargoBay]);

        return (
            <div className="calculator-container">
                <div className="header">
                    <button className="theme-toggle" onClick={toggleTheme} title="切换主题">
                        {isDarkTheme ? '☀️' : '🌙'}
                    </button>
                    <h1>🚀 火箭燃料计算器</h1>
                    <p>计算氧气不是第一需要的火箭燃料需求，精准规划你的太空任务</p>
                </div>

                <div className="content">
                    <div className="section">
                        <div className="section-title">🚀 火箭引擎选择</div>
                        <div className="input-group">
                            <div className="radio-group">
                                <label className="radio-item">
                                    <input
                                        type="radio"
                                        name="火箭引擎"
                                        value="蒸汽引擎"
                                        checked={engine === "蒸汽引擎"}
                                        onChange={e => setEngine("蒸汽引擎")}
                                    />
                                    {贴图["蒸汽引擎"] && (
                                        <img src={贴图["蒸汽引擎"]} alt="蒸汽引擎" className="radio-icon" />
                                    )}
                                    <span>蒸汽引擎</span>
                                </label>
                                <label className="radio-item">
                                    <input
                                        type="radio"
                                        name="火箭引擎"
                                        value="石油引擎"
                                        checked={engine === "石油引擎"}
                                        onChange={e => setEngine("石油引擎")}
                                    />
                                    {贴图["石油引擎"] && (
                                        <img src={贴图["石油引擎"]} alt="石油引擎" className="radio-icon" />
                                    )}
                                    <span>石油引擎</span>
                                </label>
                                <label className="radio-item">
                                    <input
                                        type="radio"
                                        name="火箭引擎"
                                        value="液氢引擎"
                                        checked={engine === "液氢引擎"}
                                        onChange={e => setEngine("液氢引擎")}
                                    />
                                    {贴图["液氢引擎"] && (
                                        <img src={贴图["液氢引擎"]} alt="液氢引擎" className="radio-icon" />
                                    )}
                                    <span>液氢引擎</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    {engine !== "蒸汽引擎" && (
                        <div className="section">
                            <div className="section-title">🧪 氧化剂选择</div>
                            <div className="input-group">
                                <div className="radio-group">
                                    <label className="radio-item">
                                        <input
                                            type="radio"
                                            name="氧化剂"
                                            value="氧石"
                                            checked={oxidizer === "氧石"}
                                            onChange={e => setOxidizer("氧石")}
                                        />
                                        {贴图["氧石"] && (
                                            <img src={贴图["氧石"]} alt="氧石" className="radio-icon" />
                                        )}
                                        <span>氧石</span>
                                    </label>
                                    <label className="radio-item">
                                        <input
                                            type="radio"
                                            name="氧化剂"
                                            value="液氧"
                                            checked={oxidizer === "液氧"}
                                            onChange={e => setOxidizer("液氧")}
                                        />
                                        {贴图["液氧"] && (
                                            <img src={贴图["液氧"]} alt="液氧" className="radio-icon" />
                                        )}
                                        <span>液氧</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="section">
                        <div className="section-title">📍 飞行距离</div>
                        <div className="input-group">
                            <select value={distance} onChange={e => setDistance(Number(e.target.value))}>
                                <option value="">选择距离</option>
                                {[...Array(20)].map((_, i) => <option key={`option_${i}`} value={(i+1)*10000}>{(i+1)*10000}KM</option>)}
                            </select>
                        </div>
                    </div>

                    <div className="section">
                        <div className="section-title">🧩 舱体配置</div>
                        <div className="module-grid">
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["指挥舱"] && (
                                        <img src={贴图["指挥舱"]} alt="指挥舱" className="module-icon" />
                                    )}
                                    <div className="module-label">指挥舱</div>
                                </div>
                                <input
                                    type="number"
                                    max="1"
                                    value={commandCapsule}
                                    disabled
                                    className="module-input"
                                />
                            </div>
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["研究舱"] && (
                                        <img src={贴图["研究舱"]} alt="研究舱" className="module-icon" />
                                    )}
                                    <div className="module-label">研究舱</div>
                                </div>
                                <input
                                    type="number"
                                    value={researchModule}
                                    onChange={e => setResearchModule(Number(e.target.value))}
                                    className="module-input"
                                />
                            </div>
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["货舱"] && (
                                        <img src={贴图["货舱"]} alt="货舱" className="module-icon" />
                                    )}
                                    <div className="module-label">货舱</div>
                                </div>
                                <input
                                    type="number"
                                    value={cargoBay}
                                    onChange={e => setCargoBay(Number(e.target.value))}
                                    className="module-input"
                                />
                            </div>
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["液缸货舱"] && (
                                        <img src={贴图["液缸货舱"]} alt="液缸货舱" className="module-icon" />
                                    )}
                                    <div className="module-label">液缸货舱</div>
                                </div>
                                <input
                                    type="number"
                                    value={liquidCargoBay}
                                    onChange={e => setLiquidCargoBay(Number(e.target.value))}
                                    className="module-input"
                                />
                            </div>
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["观光舱"] && (
                                        <img src={贴图["观光舱"]} alt="观光舱" className="module-icon" />
                                    )}
                                    <div className="module-label">观光舱</div>
                                </div>
                                <input
                                    type="number"
                                    value={sightSeeingModule}
                                    onChange={e => setSightSeeingModule(Number(e.target.value))}
                                    className="module-input"
                                />
                            </div>
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["生物货舱"] && (
                                        <img src={贴图["生物货舱"]} alt="生物货舱" className="module-icon" />
                                    )}
                                    <div className="module-label">生物货舱</div>
                                </div>
                                <input
                                    type="number"
                                    value={biologicalCargoBay}
                                    onChange={e => setBiologicalCargoBay(Number(e.target.value))}
                                    className="module-input"
                                />
                            </div>
                            <div className="module-item">
                                <div className="ingredient-with-icon">
                                    {贴图["气罐货舱"] && (
                                        <img src={贴图["气罐货舱"]} alt="气罐货舱" className="module-icon" />
                                    )}
                                    <div className="module-label">气罐货舱</div>
                                </div>
                                <input
                                    type="number"
                                    value={gasCargoCanister}
                                    onChange={e => setGasCargoCanister(Number(e.target.value))}
                                    className="module-input"
                                />
                            </div>
                            {engine === "蒸汽引擎" && (
                                <div className="module-item">
                                    <div className="ingredient-with-icon">
                                        {贴图["固体燃料推进器"] && (
                                            <img src={贴图["固体燃料推进器"]} alt="固体燃料推进器" className="module-icon" />
                                        )}
                                        <div className="module-label">固体燃料推进器</div>
                                    </div>
                                    <input
                                        type="number"
                                        value={solidFuelThruster}
                                        disabled
                                        className="module-input"
                                    />
                                </div>
                            )}
                            {engine !== "蒸汽引擎" && (
                                <>
                                    <div className="module-item">
                                        <div className="ingredient-with-icon">
                                            {贴图["液缸燃料舱"] && (
                                                <img src={贴图["液缸燃料舱"]} alt="液体燃料舱" className="module-icon" />
                                            )}
                                            <div className="module-label">液体燃料舱</div>
                                        </div>
                                        <input
                                            type="number"
                                            value={liquidFuelTank}
                                            disabled
                                            className="module-input"
                                        />
                                    </div>
                                    <div className="module-item">
                                        <div className="ingredient-with-icon">
                                            {贴图["液体氧化剂舱"] && (
                                                <img src={贴图["液体氧化剂舱"]} alt="液体氧化剂舱" className="module-icon" />
                                            )}
                                            <div className="module-label">液体氧化剂舱</div>
                                        </div>
                                        <input
                                            type="number"
                                            value={liquidOxidizerTank}
                                            disabled
                                            className="module-input"
                                        />
                                    </div>
                                </>
                            )}
                        </div>
                    </div>

                    {calculationResult && !calculationResult.error ? (
                        <div className="result-display">
                            <div className="result-title">📊 计算结果</div>
                            <div className="result-content">
                                <div className="result-content">
                                    <div className="result-success">✅ 最小燃料配置</div>
                                    <div className="result-items">
                                        {engine == "蒸汽引擎" ? <>
                                            <div className="result-item">
                                                <div className="result-item-icon">
                                                    {贴图["蒸汽"] && <img src={贴图["蒸汽"]} alt="蒸汽" className="fuel-icon" />}
                                                </div>
                                                <div className="result-item-text">
                                                    <div className="result-item-label">蒸汽燃料</div>
                                                    <div className="result-item-value">{calculationResult.solution.fuel} kg</div>
                                                </div>
                                            </div>
                                            {calculationResult.solution.thrusters > 0 ? <>
                                                <div className="result-item">
                                                    <div className="result-item-icon">
                                                        {贴图["固体燃料推进器"] && <img src={贴图["固体燃料推进器"]} alt="固体燃料推进器" className="fuel-icon" />}
                                                    </div>
                                                    <div className="result-item-text">
                                                        <div className="result-item-label">固体燃料推进器</div>
                                                        <div className="result-item-value">{calculationResult.solution.thrusters} 个</div>
                                                    </div>
                                                </div>
                                            </>:null}
                                        </>:null}
                                        {engine != "蒸汽引擎" ? <>
                                            <div className="result-item">
                                                <div className="result-item-icon">
                                                    {calculationResult.fuelIcon && <img src={calculationResult.fuelIcon} alt={calculationResult.fuelType} className="fuel-icon" />}
                                                </div>
                                                <div className="result-item-text">
                                                    <div className="result-item-label">{calculationResult.fuelType}燃料</div>
                                                    <div className="result-item-value">{calculationResult.solution.fuelAmount} kg</div>
                                                </div>
                                            </div>
                                            {calculationResult.oxidizerIcon && calculationResult.oxidizer && (
                                                <div className="result-item">
                                                    <div className="result-item-icon">
                                                        {calculationResult.oxidizerIcon && <img src={calculationResult.oxidizerIcon} alt={calculationResult.oxidizer} className="fuel-icon" />}
                                                    </div>
                                                    <div className="result-item-text">
                                                        <div className="result-item-label">{calculationResult.oxidizer}氧化剂</div>
                                                        <div className="result-item-value">{calculationResult.solution.fuelAmount} kg</div>
                                                    </div>
                                                </div>
                                            )}
                                            {calculationResult.solution.fuelTanks && (
                                                <div className="result-item">
                                                    <div className="result-item-icon">
                                                        {贴图["液缸燃料舱"] && <img src={贴图["液缸燃料舱"]} alt="燃料舱" className="fuel-icon" />}
                                                    </div>
                                                    <div className="result-item-text">
                                                        <div className="result-item-label">燃料舱</div>
                                                        <div className="result-item-value">{calculationResult.solution.fuelTanks} 个</div>
                                                    </div>
                                                </div>
                                            )}
                                            {calculationResult.solution.oxidizerTanks && (
                                                <div className="result-item">
                                                    <div className="result-item-icon">
                                                        {贴图["液体氧化剂舱"] && <img src={贴图["液体氧化剂舱"]} alt="氧化剂舱" className="fuel-icon" />}
                                                    </div>
                                                    <div className="result-item-text">
                                                        <div className="result-item-label">氧化剂舱</div>
                                                        <div className="result-item-value">{calculationResult.solution.oxidizerTanks} 个</div>
                                                    </div>
                                                </div>
                                            )}
                                        </>:null}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ): (
                        <div className="result-display">
                            <div className="result-title">📊 计算结果</div>
                            <div className="result-content">
                                <div className="result-content">
                                    <div className="result-error">❌ 无法到达目标距离</div>
                                    <div className="result-tip">请尝试减少舱体数量或缩短飞行距离</div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        )
    }
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<RocketCalculator />);
</script>
</body>
</html>